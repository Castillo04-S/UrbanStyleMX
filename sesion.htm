<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Urban Style MX</title>
    <link rel="stylesheet" href="css/stylelogin.css">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>
<main>
    <div class="wrapper">
        <form id="formLogin">
            <h1>Login</h1>

            <div class="input-box">
                <input type="email" name="correo" placeholder="Correo electrónico" required>
                <i class='bx bxs-user'></i>
            </div>

            <div class="input-box">
                <input type="password" name="pass" placeholder="Contraseña" required>
                <i class='bx bxs-lock-alt'></i>
            </div>

            <button type="submit" class="btn">Iniciar sesión</button>

            <div class="register-link">
                <p>¿No tienes cuenta? <a href="registro.htm">Regístrate</a></p>
            </div>
        </form>
    </div>
</main>

<script>
window.onload = () => {
    const rol = localStorage.getItem("rol");
    const nombre = localStorage.getItem("nombre");
    if (rol && nombre) {
        alert(`Ya tienes sesión activa como ${nombre} (${rol}).`);
        window.location.href = "index.html"; 
    }
};

document.getElementById("formLogin").addEventListener("submit", async (event) => {
    event.preventDefault();

    const formData = new FormData(event.target);
    formData.append("accion", "login");

    try {
        const res = await fetch("servidor/usuarios.php", {
            method: "POST",
            body: formData
        });

        const text = await res.text();
        console.log("Respuesta del servidor:", text);

        let data;
        try {
            data = JSON.parse(text);
        } catch {
            throw new Error("Respuesta no válida del servidor.");
        }

        alert(data.mensaje);

        if (data.mensaje.includes("✅")) {
            localStorage.setItem("rol", data.rol);
            localStorage.setItem("nombre", data.nombre);
            localStorage.setItem("correo", data.correo);
            window.location.href = "index.html";
        }
    } catch (err) {
        console.error("Error al conectar con el servidor:", err);
        alert("❌ Error de conexión con el servidor.");
    }
});
</script>
</body>
</html>
